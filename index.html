<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS // TERMINAL</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

    <style>
        :root {
            /* Palette Pro Dark Theme */
            --bg-dark: #0d1117;       /* Fond principal (GitHub Dark style) */
            --bg-panel: #161b22;      /* Fond des panneaux */
            --border: #30363d;        /* Bordures subtiles */
            
            --text-main: #c9d1d9;
            --text-muted: #8b949e;
            
            --accent-green: #238636;  /* Vert "Gain" plus pro, moins néon */
            --accent-green-text: #3fb950;
            --accent-red: #da3633;    /* Rouge "Perte" mat */
            --accent-red-text: #f85149;
            --accent-blue: #58a6ff;
            
            --font-ui: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-ui);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            font-size: 13px; /* Taille pro, compacte */
        }

        /* --- Custom Scrollbar (Crucial pour le look pro) --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* --- Header --- */
        header {
            height: 48px;
            border-bottom: 1px solid var(--border);
            background-color: var(--bg-panel);
            display: flex;
            align-items: center;
            padding: 0 16px;
            justify-content: space-between;
            flex-shrink: 0;
        }
        .brand { font-family: var(--font-mono); font-weight: 700; font-size: 14px; letter-spacing: -0.5px; }
        .brand span { color: var(--accent-blue); }
        
        .ticker-tape {
            display: flex;
            gap: 20px;
            font-family: var(--font-mono);
            font-size: 12px;
        }
        .ticker-item span:last-child { margin-left: 5px; }

        /* --- Layout Grid --- */
        .grid-container {
            display: grid;
            grid-template-columns: 240px 1fr 280px; /* Sidebar, Chart, OrderBook */
            grid-template-rows: 100px 1fr 180px;    /* KPI, Chart, Logs */
            height: calc(100vh - 48px);
            gap: 1px;
            background-color: var(--border); /* Les lignes de la grille */
        }

        .panel {
            background-color: var(--bg-dark);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .panel-head {
            height: 32px;
            padding: 0 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            background-color: var(--bg-panel);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            user-select: none;
        }

        /* --- KPI Top Bar --- */
        .kpi-section {
            grid-column: 1 / -1; /* Toute la largeur */
            grid-row: 1 / 2;
            display: flex;
            background: var(--bg-dark);
        }
        .kpi-box {
            flex: 1;
            border-right: 1px solid var(--border);
            padding: 15px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .kpi-label { font-size: 11px; color: var(--text-muted); margin-bottom: 6px; }
        .kpi-val { font-family: var(--font-mono); font-size: 20px; font-weight: 600; }
        .kpi-sub { font-size: 11px; margin-top: 4px; display: flex; align-items: center; gap: 4px; }

        /* --- Sidebar --- */
        .sidebar { grid-row: 2 / -1; grid-column: 1 / 2; }
        .nav-item {
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-item:hover { background-color: var(--bg-panel); }
        .nav-item.active { border-left: 3px solid var(--accent-blue); background-color: #1c2128; }
        .nav-name { font-weight: 500; font-size: 12px; }
        .nav-status { width: 6px; height: 6px; border-radius: 50%; }
        .status-on { background-color: var(--accent-green-text); box-shadow: 0 0 5px rgba(63,185,80,0.4); }
        .status-off { background-color: var(--border); }

        /* --- Chart Area --- */
        .chart-area { grid-row: 2 / 3; grid-column: 2 / 3; }
        #tv-chart { width: 100%; height: 100%; }

        /* --- Order Book (Right) --- */
        .orderbook { grid-row: 2 / 4; grid-column: 3 / 4; font-family: var(--font-mono); }
        .ob-header { 
            display: grid; grid-template-columns: 1fr 1fr 1fr; 
            padding: 8px 12px; font-size: 10px; color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }
        .ob-list { overflow-y: auto; flex: 1; }
        .ob-row {
            display: grid; grid-template-columns: 1fr 1fr 1fr;
            padding: 3px 12px;
            font-size: 11px;
            cursor: pointer;
            position: relative; /* Pour la barre de profondeur */
        }
        .ob-row:hover { background-color: rgba(255,255,255,0.03); }
        /* Simulation de profondeur */
        .depth-bar {
            position: absolute;
            top: 0; right: 0; bottom: 0;
            background-color: rgba(63, 185, 80, 0.1);
            z-index: 0;
        }
        .depth-bar.ask { background-color: rgba(248, 81, 73, 0.1); }
        .ob-cell { z-index: 1; text-align: right; }
        .ob-cell:first-child { text-align: left; }
        
        .color-buy { color: var(--accent-green-text); }
        .color-sell { color: var(--accent-red-text); }

        /* --- Console/Logs --- */
        .console { grid-row: 3 / 4; grid-column: 2 / 3; font-family: var(--font-mono); }
        .log-container { overflow-y: auto; padding: 10px; font-size: 11px; line-height: 1.6; }
        .log-line { display: flex; gap: 10px; opacity: 0.8; }
        .log-time { color: var(--text-muted); min-width: 70px; }
        .log-type { color: var(--accent-blue); }

        /* Utility Colors */
        .up { color: var(--accent-green-text); }
        .down { color: var(--accent-red-text); }

        /* Mobile Responsive */
        @media (max-width: 900px) {
            .grid-container {
                display: flex; flex-direction: column; height: auto;
            }
            .chart-area { height: 400px; }
            .orderbook { height: 300px; border-top: 1px solid var(--border); }
            .kpi-section { flex-wrap: wrap; }
            .kpi-box { min-width: 50%; border-bottom: 1px solid var(--border); }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">NEXUS // <span>PRO</span></div>
        <div class="ticker-tape">
            <div class="ticker-item">S&P 500 <span class="up">+1.2%</span></div>
            <div class="ticker-item">BTC <span class="down">-0.4%</span></div>
            <div class="ticker-item">VIX <span class="down">-2.1%</span></div>
            <div class="ticker-item" style="color: var(--text-muted);">LATENCY: 14ms</div>
        </div>
    </header>

    <div class="grid-container">

        <div class="kpi-section">
            <div class="kpi-box">
                <span class="kpi-label">NET LIQUIDATION</span>
                <span class="kpi-val">$142,590.00</span>
                <span class="kpi-sub up">+$2,340 (1.6%) Today</span>
            </div>
            <div class="kpi-box">
                <span class="kpi-label">MARGIN USAGE</span>
                <span class="kpi-val">24.5%</span>
                <span class="kpi-sub" style="color:var(--text-muted)">Healthy</span>
            </div>
            <div class="kpi-box">
                <span class="kpi-label">OPEN POSITIONS</span>
                <span class="kpi-val">4</span>
                <span class="kpi-sub">Long: 3 | Short: 1</span>
            </div>
            <div class="kpi-box">
                <span class="kpi-label">DAY VOLUME</span>
                <span class="kpi-val">$2.4M</span>
                <span class="kpi-sub">High Freq Active</span>
            </div>
        </div>

        <div class="panel sidebar">
            <div class="panel-head">ALGORITHMS</div>
            <div class="nav-item active">
                <div>
                    <div class="nav-name">BTC_SCALP_V4</div>
                    <div style="font-size:10px; color:var(--text-muted)">Mean Reversion</div>
                </div>
                <div class="nav-status status-on"></div>
            </div>
            <div class="nav-item">
                <div>
                    <div class="nav-name">ETH_ARBITRAGE</div>
                    <div style="font-size:10px; color:var(--text-muted)">DEX/CEX Spread</div>
                </div>
                <div class="nav-status status-on"></div>
            </div>
            <div class="nav-item">
                <div>
                    <div class="nav-name">GOLD_HEDGE</div>
                    <div style="font-size:10px; color:var(--text-muted)">Macro Sentiment</div>
                </div>
                <div class="nav-status status-off"></div>
            </div>
        </div>

        <div class="panel chart-area">
            <div class="panel-head">
                <span>BTC/USD PERPETUAL</span>
                <span style="font-size:10px; opacity:0.6;">1H TIMEFRAME</span>
            </div>
            <div id="tv-chart"></div>
        </div>

        <div class="panel console">
            <div class="panel-head">SYSTEM EVENTS</div>
            <div class="log-container" id="log-feed">
                </div>
        </div>

        <div class="panel orderbook">
            <div class="panel-head">ORDER BOOK (L2)</div>
            <div class="ob-header">
                <span style="text-align:left">PRICE</span>
                <span style="text-align:right">SIZE</span>
                <span style="text-align:right">TOTAL</span>
            </div>
            <div class="ob-list" id="ob-feed">
                </div>
        </div>

    </div>

    <script>
        // --- CONFIGURATION DU GRAPHIQUE ---
        const chartContainer = document.getElementById('tv-chart');
        const chart = LightweightCharts.createChart(chartContainer, {
            layout: {
                background: { type: 'solid', color: '#0d1117' }, // Match CSS var
                textColor: '#8b949e',
                fontFamily: 'Inter',
            },
            grid: {
                vertLines: { color: '#161b22' },
                horzLines: { color: '#161b22' },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
            rightPriceScale: {
                borderColor: '#30363d',
                scaleMargins: { top: 0.1, bottom: 0.3 }, // Laisse place au volume
            },
            timeScale: {
                borderColor: '#30363d',
                timeVisible: true,
            },
        });

        // 1. Candlestick Series
        const candleSeries = chart.addCandlestickSeries({
            upColor: '#238636',
            downColor: '#da3633',
            borderVisible: false,
            wickUpColor: '#238636',
            wickDownColor: '#da3633',
        });

        // 2. Volume Series (Histogram at bottom)
        const volumeSeries = chart.addHistogramSeries({
            color: '#26a69a',
            priceFormat: { type: 'volume' },
            priceScaleId: '', // Overlay on same chart
            scaleMargins: { top: 0.8, bottom: 0 },
        });

        // 3. Moving Average Line
        const maSeries = chart.addLineSeries({
            color: '#58a6ff',
            lineWidth: 1,
            crosshairMarkerVisible: false,
            lastValueVisible: false,
            priceLineVisible: false,
        });

        // --- GÉNÉRATION DE DONNÉES FICTIVES "PRO" ---
        let data = [];
        let volumeData = [];
        let maData = [];
        
        // Point de départ
        let time = Math.floor(Date.now() / 1000) - (24 * 60 * 60); // Hier
        let price = 42500;

        for (let i = 0; i < 500; i++) {
            // Random Walk plus réaliste
            let change = (Math.random() - 0.5) * 150; 
            let open = price;
            let close = price + change;
            let high = Math.max(open, close) + Math.random() * 50;
            let low = Math.min(open, close) - Math.random() * 50;
            
            // Couleur Volume
            let color = close > open ? 'rgba(35, 134, 54, 0.4)' : 'rgba(218, 54, 51, 0.4)';
            
            data.push({ time, open, high, low, close });
            volumeData.push({ time, value: Math.random() * 1000, color });
            
            // Simple Moving Average calc
            if (i > 20) {
                let sum = 0;
                for (let k = 0; k < 20; k++) sum += data[i-k].close;
                maData.push({ time, value: sum / 20 });
            }

            price = close;
            time += 300; // 5 min candles
        }

        candleSeries.setData(data);
        volumeSeries.setData(volumeData);
        maSeries.setData(maData);

        // Resize Chart auto
        new ResizeObserver(entries => {
            if (entries.length === 0 || entries[0].target !== chartContainer) return;
            const newRect = entries[0].contentRect;
            chart.applyOptions({ width: newRect.width, height: newRect.height });
        }).observe(chartContainer);


        // --- SIMULATION ORDER BOOK (L2) ---
        const obFeed = document.getElementById('ob-feed');
        
        function renderOrderBook() {
            obFeed.innerHTML = '';
            let currentPrice = data[data.length - 1].close;
            
            // Generates Sell Orders (Red)
            for(let i=8; i>0; i--) {
                let p = (currentPrice + i * 5).toFixed(1);
                let size = (Math.random() * 2).toFixed(3);
                let depth = Math.floor(Math.random() * 80); // % width
                
                obFeed.innerHTML += `
                <div class="ob-row">
                    <div class="depth-bar ask" style="width:${depth}%"></div>
                    <div class="ob-cell color-sell">${p}</div>
                    <div class="ob-cell">${size}</div>
                    <div class="ob-cell" style="opacity:0.5">${(size*p/1000).toFixed(1)}K</div>
                </div>`;
            }
            
            // Spread divider
            obFeed.innerHTML += `<div style="text-align:center; padding:5px; color:#58a6ff; font-weight:bold; border-top:1px solid #30363d; border-bottom:1px solid #30363d; background:#161b22;">${currentPrice.toFixed(1)}</div>`;

            // Generates Buy Orders (Green)
            for(let i=1; i<9; i++) {
                let p = (currentPrice - i * 5).toFixed(1);
                let size = (Math.random() * 3).toFixed(3);
                let depth = Math.floor(Math.random() * 80); 
                
                obFeed.innerHTML += `
                <div class="ob-row">
                    <div class="depth-bar" style="width:${depth}%"></div>
                    <div class="ob-cell color-buy">${p}</div>
                    <div class="ob-cell">${size}</div>
                    <div class="ob-cell" style="opacity:0.5">${(size*p/1000).toFixed(1)}K</div>
                </div>`;
            }
        }
        
        // --- SIMULATION LOGS ---
        const logFeed = document.getElementById('log-feed');
        const logTypes = ['[INFO]', '[EXEC]', '[WARN]'];
        const logMsgs = [
            'Fetching depth snapshot...',
            'Order limit placed at best bid',
            'Latency spike detected: 45ms',
            'Strategy rebalancing portfolio',
            'WebSocket heartbeat received'
        ];

        function addLog() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', {hour12:false, hour:'2-digit', minute:'2-digit', second:'2-digit'});
            const type = logTypes[Math.floor(Math.random()*logTypes.length)];
            const msg = logMsgs[Math.floor(Math.random()*logMsgs.length)];
            
            const div = document.createElement('div');
            div.className = 'log-line';
            div.innerHTML = `<span class="log-time">${timeStr}</span> <span class="log-type">${type}</span> <span>${msg}</span>`;
            
            logFeed.prepend(div); // Add to top
            if(logFeed.children.length > 50) logFeed.removeChild(logFeed.lastChild);
        }

        // --- LOOPS DE SIMULATION ---
        renderOrderBook(); // Init
        setInterval(renderOrderBook, 1500); // Refresh book
        setInterval(addLog, 3000); // Add log

        // Live Candle Update Simulation
        setInterval(() => {
            let lastCandle = data[data.length - 1];
            let newPrice = lastCandle.close + (Math.random() - 0.5) * 20;
            
            // Update current candle
            lastCandle.close = newPrice;
            lastCandle.high = Math.max(lastCandle.high, newPrice);
            lastCandle.low = Math.min(lastCandle.low, newPrice);
            
            candleSeries.update(lastCandle);
            
            // Update Title Dynamic
            document.title = `${newPrice.toFixed(2)} BTC/USD | NEXUS`;
        }, 200);

    </script>
</body>
</html>
